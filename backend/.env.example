# =============================================================================
# Easy Smart Monitor - API Backend v1.1.0
# Copie este arquivo para .env e ajuste os valores para seu ambiente.
# cp .env.example .env
# =============================================================================

# -----------------------------------------------------------------------------
# Ambiente (GLOBAL)
# -----------------------------------------------------------------------------
# Modo de execução da aplicação. "development" exibe mais logs; "production" otimiza performance.
NODE_ENV=development

# -----------------------------------------------------------------------------
# Shared (Gateway + Workers)
# -----------------------------------------------------------------------------
# Banco de Dados (PostgreSQL / TimescaleDB)
# [OBRIGATÓRIO EM PRODUÇÃO] Configure DATABASE_URL OU POSTGRES_* corretamente.
DATABASE_URL=postgresql://easysmart:SUA_SENHA@localhost:5432/easysmart_db
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=easysmart
POSTGRES_PASSWORD=easysmart_password
POSTGRES_DB=easysmart_db
# Para Workers Python: a URL deve usar o driver asyncpg (ex.: postgresql+asyncpg://...).
# DATABASE_URL=postgresql+asyncpg://easysmart:SUA_SENHA@postgres:5432/easysmart_db

# Kafka (fila de mensagens - claim check)
# [OBRIGATÓRIO EM PRODUÇÃO]
KAFKA_BROKERS=localhost:9092
KAFKA_TOPIC=telemetry.raw

# Storage - Claim Check Pattern (MinIO ou Local)
# [OBRIGATÓRIO EM PRODUÇÃO] Configure credenciais e bucket.
STORAGE_TYPE=minio
MINIO_ENDPOINT=localhost
MINIO_PORT=9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=telemetry-raw
MINIO_REGION=us-east-1
MINIO_USE_SSL=false
STORAGE_LOCAL_PATH=/app/storage

# Multi-tenant (Gateway + Workers)
MULTI_TENANT_ENABLED=false
# Se true, bloqueia requisições sem tenant_id (use somente após migração completa).
MULTI_TENANT_ENFORCE=false
# Headers opcionais (se não estiver no JWT). Ex.: x-tenant-id no /auth/login.
TENANT_HEADER=x-tenant-id
ORGANIZATION_HEADER=x-organization-id
WORKSPACE_HEADER=x-workspace-id
# Tenant padrão (usado na migration 007 para dados legados).
DEFAULT_TENANT_SLUG=legacy
DEFAULT_TENANT_NAME=Legacy Tenant

# Planos e Quotas (SaaS / Billing)
# [OBRIGATÓRIO EM PRODUÇÃO] se você for aplicar limites por plano.
DEFAULT_PLAN_CODE=legacy
DEFAULT_PLAN_NAME=Legacy Plan
DEFAULT_PLAN_ITEMS_PER_DAY=
DEFAULT_PLAN_SENSORS_PER_DAY=
DEFAULT_PLAN_BYTES_PER_DAY=
# Ativa enforcement de quotas na ingestão.
QUOTA_ENABLED=false
QUOTA_ENFORCE=false
# Se true, calcula bytes da requisição (pode ser custoso).
QUOTA_ESTIMATE_BYTES=false
# Registra eventos de billing (ex.: quota excedida).
BILLING_EVENTS_ENABLED=false

# White-label (GLOBAL / SaaS)
# [OBRIGATÓRIO EM PRODUÇÃO] apenas se oferecer white-label.
WHITE_LABEL_ENABLED=false
# Configuração padrão (fallback quando tenant não tem branding próprio).
WHITE_LABEL_DEFAULT_APP_NAME=Easy Smart Monitor
WHITE_LABEL_DEFAULT_LOGO_URL=
WHITE_LABEL_DEFAULT_PRIMARY_COLOR=#0066cc
WHITE_LABEL_DEFAULT_SECONDARY_COLOR=#004499
WHITE_LABEL_DEFAULT_SUPPORT_EMAIL=suporte@exemplo.com
WHITE_LABEL_DEFAULT_SUPPORT_PHONE=
WHITE_LABEL_DEFAULT_DOMAIN=

# -----------------------------------------------------------------------------
# Gateway (Node.js / Fastify)
# -----------------------------------------------------------------------------
# Endereço em que o Gateway escuta (0.0.0.0 = todas as interfaces; use para Docker).
HOST=0.0.0.0
# Porta HTTP em que a API fica disponível (ex.: 8000 para http://localhost:8000).
PORT=8000

# JWT
# [OBRIGATÓRIO EM PRODUÇÃO] Use chave longa e aleatória (mín. 32 caracteres).
SECRET_KEY=change-me-in-production-min-32-chars
# Tempo de vida do access token em minutos.
ACCESS_TOKEN_EXPIRE_MINUTES=15

# Rate Limiting
RATE_LIMIT_PER_MINUTE=1000

# CORS (URLs do frontend/dashboard)
CORS_ORIGINS=http://localhost:3000,http://localhost:8080

# Telemetria (Gateway)
MAX_BULK_SIZE=10000

# Redis (Gateway - rate limit + penalty box + locks)
# [OBRIGATÓRIO EM PRODUÇÃO] se usar rate limit distribuído / shield.
REDIS_URL=redis://localhost:6379/0

# Logging (Gateway)
# Nível: debug, info, warn, error.
LOG_LEVEL=info

# -----------------------------------------------------------------------------
# Workers Python
# -----------------------------------------------------------------------------
# Banco de dados (pool)
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=10

# Kafka (consumer)
KAFKA_GROUP_ID=telemetry-workers
KAFKA_BATCH_SIZE=100
KAFKA_AUTO_COMMIT=false

# Processamento
BULK_INSERT_BATCH_SIZE=1000
MAX_RETRIES=3
RETRY_DELAY=5
DELETE_FILE_AFTER_PROCESSING=true
FILE_RETENTION_DAYS=7

# Observabilidade / Billing (Workers)
# Registra uso diário por tenant na tabela tenant_usage_daily (billing-ready).
BILLING_USAGE_ENABLED=false

# Logging (Workers)
# Nível: DEBUG, INFO, WARNING, ERROR.
# Observação: usa a mesma variável LOG_LEVEL do Gateway.
LOG_LEVEL=INFO
LOG_FORMAT=json
DEBUG=false

# -----------------------------------------------------------------------------
# Docker Compose (opcional)
# -----------------------------------------------------------------------------
# Variáveis lidas pelo docker-compose. Defina no .env na raiz do backend.
# POSTGRES_PASSWORD=easysmart_password
# MINIO_ROOT_USER=minioadmin
# MINIO_ROOT_PASSWORD=minioadmin
# SECRET_KEY=change-me-in-production-min-32-chars
# VALID_USERS={"admin":"admin123"}

# -----------------------------------------------------------------------------
# Usuário Master (bootstrap do dashboard)
# -----------------------------------------------------------------------------
# Use após a instalação para criar o admin global do sistema (tenant_id=0).
# Esse usuário é responsável por criar empresas, planos e demais usuários.
# [OBRIGATÓRIO EM PRODUÇÃO] se você quiser bootstrap automático do admin.
MASTER_ADMIN_ENABLED=false
MASTER_ADMIN_USERNAME=admin
MASTER_ADMIN_PASSWORD=change-me-now
MASTER_ADMIN_EMAIL=admin@localhost
MASTER_ADMIN_TENANT_ID=0
MASTER_ADMIN_ORGANIZATION_ID=0
MASTER_ADMIN_WORKSPACE_ID=0
